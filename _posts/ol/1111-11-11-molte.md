---
layout: post
title: Apply Modular Optimal Learning Testing Environment for Drug Discovery
category: OL
tags: AI OL CADD
date: 2019-6-2
---

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

* content
{:toc}

## TODO
MOLTE的实现

## 1. MOLTE简介

Modular Optimal Learning Testing Environment（MOLTE）是一个基于MATLAB的学习规则模拟器，用于解决贝叶斯排序和选择问题，以及随机式赌博机问题。[^1]MOLTE模拟器适用于候选方案为**离散集合**的决策问题。如材料构成，药物组成，产品特性和医学诊断。

MOLTE模拟器将于Excel电子表格中每一个问题的每一个规则对比运行numP次（numP定义位于MOLTE.m）。MOLTE模拟器每次运行将产生numTruth个不同的样例路径，由每个规则共享。之后计算每个样例路径的目标函数值，并平均此numTruth次尝试的值，作为期望终值或者期望累加值。使用时可指定使用在线目标函数（赌博机问题），或者离线目标函数（排序、选择问题或者随机搜索问题，详见3.1)。

## 2. MOLTE使用流程

1. 定义问题类（使用Standard API）
2. 定义规则类（使用Standard API，Optional）
3. 使用Excel电子表格指定问题类和规则类（详见3.1)
4. 使用MATLAB运行
5. 生成输出文件

### 2.1 使用MOLTE进行虚拟筛选

参考资料：Frazier, D. M. N. P. I. (2009). Optimal Learning for Drug Discovery in Ewing’s Sarcoma.

TODO:

## 3. 问题输入

### 3.1 Excel电子表格（指定问题和规则）

每个问题需指定以下信息：
1. Problem class，问题类：预先编码于文件夹problemClasses中的文件。该项应与文件名相同。如果需要指定
2. Prior，优先级：获取优先级的方法。
* Default：使用问题预先定义的优先级。
* MLT：使用MLT初始化的拉丁超立方设计（Latin hypercube designs）。[^2]
* Given：由参数或者优先级文件给出（文件名：Prior_问题类.mat）
* Uninformative：使用零均值化和infinite variance。
3. Measurement Budget，测量预算：指定决策过程的时间范围与备选方案数量之间的比率。
4. Belief Model，信念模型。
5. Offline/Online，在线/离线：指定目标函数是最大化最终值还是总值。
6. Number of Policies，规则数：用于对比的规则数量，之后提供规则名称。

示例：
<table><tr><th>Problem class</th><th>Prior</th><th>Measurement Budget N</th><th>Belief Model</th><th>Offline/Online</th><th>Number of Policies</th><th></th><th></th><th></th><th></th></tr><tr><td>PayloadD</td><td>MLE</td><td>0.2</td><td>correlated</td><td>Offline</td><td>4</td><td>kriging</td><td>EXPL</td><td>IE(1.7)</td><td>ThompsonSampling</td></tr><tr><td>Branin</td><td>MLE</td><td>0.1</td><td>correlated</td><td>Online</td><td>4</td><td>OLkgcb</td><td>UCBEcb(*)</td><td>BayesUCB</td><td>IE(1.2)</td></tr><tr><td>Bubeck4</td><td>uninformative</td><td>5</td><td>independent</td><td>Online</td><td>4</td><td>OLKG </td><td>UCB</td><td>SR</td><td>UCBV</td></tr><tr><td>GPR</td><td>Default</td><td>0.3</td><td>correlated</td><td>Offline</td><td>4</td><td>kriging</td><td>kgcb</td><td>IE(1)</td><td>EXPT</td></tr></table>


### 3.3 预定义问题类（共23种）

1. **Bubeck’s Experiments**: (Audibert et al. 2010) We consider Bernoulli distributions with the mean of the best arm always μ 1 = 0.5. M is the number of arms.[^3]
$$
\begin{array}{l}{Bubeck1: M=20, \mu_{2 : 20}=0.4} \\ {Bubeck2: M=20, \mu_{2 : 6}=0.42, \mu 7 : 20=0.38} \\ {Bubeck3: M=4, \mu_{i}=0.5-(0.37)^{i}, i \in\{2,3,4\}} \\ {Bubeck4: M=6, \mu_{2}=0.42, \mu_{3 : 4}=0.4, \mu_{5 : 6}=0.35} \\ {Bubeck5: M=15, \mu_{i}=0.5-0.025 i, i \in\{2, \cdots, 15\}} \\ {Bubeck6: M=20, \mu_{2}=0.48, \mu_{3 : 20}=0.37} \\ {Bubeck7: M=30, \mu_{2 : 6}=0.45, \mu_{7 : 20}=0.43, \mu_{21 : 30}=0.38}\end{array}
$$
2. **Asymmetric unimodular function (AUF)**: x is a controllable parameter ranging from 21 to 120. The objective function is $$F(x, \xi)=\theta_{1} \min (x, \xi)-\theta_{2} x$$, where $$\theta_{1}, \theta_{2}$$ and the distribution of the random variable ξ are all unknown. ξ is taken as a normal distribution with mean 60. Three noise levels are considered by setting different noise ratios between the standard deviation and the mean of ξ: HNoise–0.5, MNoise–0.4, LNoise–0.3. Unless explicitly pointed out, experiments are taken under LNoise.
3. **Equal-prior**: M = 100. The true values $$\mu_{x}$$ are uniformly distributed over [0, 60] and measurement noise $$\delta_{W} = 100$$. $$\theta^{0}_{x} = 30$$ and $$\delta^{0}_{x} = 10$$ for every x.All the standard optimization test functions are flipped in MOLTE to generate maximization
problems instead of minimization in line with R&S and bandit problems. The standarddeviation of the additive Guassion noise is set to 20 percent of the range of the functionvalues.
4. Rosenbrock functions with additive noise:
$$
f(x, y, \phi)=100\left(y-x^{2}\right)^{2}+(1-x)^{2}+\phi
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 13 × 13  alternatives.
5. Pinter’s function with additive noise:
$$
\begin{aligned} f(x, y, \phi) &=\log _{10}\left(1+\left(y^{2}-2 x+3 y-\cos x+1\right)^{2}\right)+\log _{10}\left(1+2\left(x^{2}-2 y+3 x-\cos y+1\right)^{2}\right) \\ &+x^{2}+2 y^{2}+20 \sin ^{2}(y \sin x-x+\sin y)+40 \sin ^{2}(x \sin y-y+\sin x)+1+\phi \end{aligned}
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 13 × 13 alternatives.
6. Goldstein-Price’s function with additive noise:
$$
\begin{aligned} f(x, y, \phi)=&\left[1+(x+y+1)^{2}\left(19-14 x+3 x^{2}-14 y+6 x y+3 y^{2}\right)\right] \\ &\left[30+(2 x-3 y)^{2}\left(18-32 x+12 x^{2}+48 y-36 x y+27 y^{2}\right)\right]+\phi \end{aligned}
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 13 × 13 alternatives.
7. Branins’s function with additive noise:
$$
f(x, y, \phi)=\left(y-\frac{5.1}{4 \pi^{2}} x^{2}+\frac{5}{\pi} x-6\right)^{2}+10\left(1-\frac{1}{8 \pi}\right) \cos (x)+10+\phi
$$
where −5 ≤ x ≤ 10, 0 ≤ y ≤ 15. x and y are uniformly discretized into 15 × 15 alternatives.
8. Ackley’s function with additive noise:
$$
f(x, y, \phi)=-20 \exp \left(-0.2 \cdot \sqrt{\frac{1}{2}\left(x^{2}+y^{2}\right)}\right)-\exp \left(\frac{1}{2}(\cos (2 \pi x)+\cos (2 \pi y))\right)+20+\exp (1)+\phi
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 13 × 13 alternatives.
9. Hyper Ellipsoid function with additive noise:
$$
f(x, y, \phi)=x^{2}+2 y^{2}+\phi
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 13 × 13 alternatives.
10. Rastrigin function with additive noise:
$$
f(x, y, \phi)=20+\left[x^{2}-10 \cos (2 \pi x)\right]+\left[x^{2}-10 \cos (2 \pi y)\right]+\phi
$$
where −3 ≤ x ≤ 3, −3 ≤ y ≤ 3. x and y are uniformly discretized into 11 × 11 alternatives.
11.  Six-hump camel back function with additive noise:
$$
f(x, y, \phi)=\left(4-2.1 x^{2}+\frac{x^{4}}{3}\right) x^{2}+x y+\left(-4+4 y^{2}\right) y^{2}+\phi
$$
where −2 ≤ x ≤ 2, −1 ≤ y ≤ 1. x and y are uniformly discretized into 13 × 13 alternative.

### 3.4 预定义规则类（共20种）

We have pre-coded various state-of-the-art policies π, which differ according to their decision $$ X^{\pi, n}\left(S^{n}\right) $$ of the alternative to measure at time n given state S^{n}.
1. **Knowledge gradient (KG)**: (Frazier et al. 2008; Frazier, Powell, and Dayanik 2009) This policy is designed for offline objective (1). Define the knowledge gradient:
$$
\nu_{x}^{\mathrm{KG}, n}=\mathbb{E}\left[\max _{x^{\prime}} \theta_{x^{\prime}}^{n+1}-\max _{x^{\prime}} \theta_{x^{\prime}}^{n} | x^{n}=x, S^{n}\right]
$$

### 3.4 定义问题类

TODO:

### 3.5 定义规则类

TODO:

## 4. 问题输出

1. objectiveFunction.mat 每一次尝试的目标函数值。
2. choice.mat 每一步使用的规则。
3. FinalFit.mat 当测量预算用尽时的最终估值和相应的情况。
4. alpha.txt 需要调参的规则的可调参数。
5. offline_hist.pdf 终值分布直方图。
6. online_hist.pdf 总值分布直方图。
7. histChoice.m can read in the choice.mat and generate the distribution of the chosen alternatives for each policy and each trial. e,g, the right figure shows the frequency of choosing each of the 100 alternatives with a measurement budget of 300.
8. genProb.m can read in the objectiveFunction.mat and depict the mean opportunity cost
with error bars indicating the standard deviation of each policy (in OC_hist.tif) as shown
in the following left figure , together with the probability of each policy being optimal
and being the best in the following right figure.

## 示例问题
1.  Bubeck1~Bubeck7
1.  Asymmetric Unimodular Functions with the parameter chosen to be 0.2,0.5 and 0.8 with high or medium noise level, respectively
1.  Rosenbrock function with additive noise
1.  Pinter's function with additive noise
1.  Goldstein function with additive noise
1.  Griewank function with additive noise
1.  Branin’s function with additive noise
1.  Axis parallel hyper-ellipsoid function with additive noise
1.  Rastrigin’s function with additive noise
1.  Ackley’s function with additive noise
1.  Six-hump camel back function with additive noise
1.  Easom function with additive noise


## 示例规则
1. Interval Estimation (IE) 可用于关联信念模型
1. Kriging 可用于关联信念模型
1. UCB (and a modified version UCBcb incorporating correlated beliefs)
1. UCBNormal
1. UCB-E (and a modified version UCBEcb incorporating correlated beliefs)
1. UCB-V(and a modified version UCBVcb incorporating correlated beliefs)
1. Bayes-UCB 可用于关联信念模型
1. KL-UCB
1. Knowledge gradient policy for offline learning 可用于关联信念模型
1. Knowledge gradient for online learning 可用于关联信念模型
1. Successive rejects
1. Thompson sampling 可用于关联信念模型
1. Pure exploration 可用于关联信念模型
1. Pure exploitation 可用于关联信念模型

## 注释

[^1]: 多臂赌博机问题(multi-armed bandit problem),也称为顺序资源分配问题(sequential resource allocation problem)。假设有个老虎机并排放在我们面前,我们首先给它们编号,每一轮,我们可以选择一个老虎机来按,同时记录老虎机给出的奖励. 假设各个老虎机不是完全相同的,经过多轮操作后,我们可以勘探出各个老虎机的部分统计信息,然后选择那个看起来奖励最高的老虎机. 在多臂赌博机中,我们把老虎机称为臂.这里有两个问题:**奖励以什么方式产生**.我们可以想见有很多种方式产生这种奖励:1. 随机式(stochastic bandit): 臂的奖励服从某种固定的概率分布.2. 对抗式(adversarial bandit): 赌场老板使坏,会动态调整臂的奖励,比如让你选的臂的奖励很低,但是其它未选的臂奖励变高.注意这里赌场老板不能也不会使全部臂的奖励变为0,因为这样会使我们无法得到奖励,这时我们体验到的是任何策略都是无差别的.3. 马尔可夫式(Markovian bandit): 臂奖励由马尔可夫链定义.**如何测量策略的好坏**简单的以总奖励作为测量策略好坏的标准是不切实际的. 所以我们定义遗憾(regret)作为策略好坏的指标,指的是我们可以达到的最理想总奖励与实际得到的总奖励.

[^2]: 在拉丁超立方中，每个因子具有与设计中试验次数相同的水平数。这些水平在因子的下限和上限之间等间距分布。与球堆积方法类似，拉丁超立方方法选择点使设计点之间的最小距离最大化，但是具有约束。约束可保持因子水平之间等间距。

[^3]: [Audibert, J. Y., & Bubeck, S. (2010, June). Best arm identification in multi-armed bandits. In COLT-23th Conference on learning theory-2010 (pp. 13-p).](http://imagine.enpc.fr/publications/papers/COLT10.pdf)